<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>PDFGo – PDF to Images</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="แปลง PDF เป็นรูปภาพออนไลน์ ฟรี ทำงานในเบราว์เซอร์ ไม่อัปโหลดไฟล์" />

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f8fafc;
      padding: 30px;
    }

    .container {
      max-width: 520px;
      margin: auto;
      background: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    #drop-zone {
      border: 2px dashed #94a3b8;
      padding: 40px;
      text-align: center;
      border-radius: 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    #drop-zone.dragover {
      border-color: #6366f1;
      background: #eef2ff;
    }

    .options {
      display: flex;
      gap: 10px;
      margin: 16px 0;
    }

    .options input {
      width: 100%;
      padding: 8px;
    }

    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    button:disabled {
      opacity: .5;
    }

    progress {
      width: 100%;
      height: 16px;
      margin-top: 14px;
    }

    footer {
      text-align: center;
      font-size: 12px;
      margin-top: 20px;
      color: #64748b;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>PDF → รูปภาพ</h1>

  <div id="drop-zone">
    ลากไฟล์ PDF มาวาง<br>หรือคลิกเพื่อเลือกไฟล์
    <input type="file" id="fileInput" accept="application/pdf" hidden>
  </div>

  <div class="options">
    <input type="number" id="startPage" value="1" min="1" placeholder="หน้าเริ่ม">
    <input type="number" id="endPage" value="1" min="1" placeholder="หน้าสิ้นสุด">
  </div>

  <button id="convertBtn" disabled>แปลงไฟล์</button>

  <progress id="progress" value="0" max="100"></progress>
  <p id="progressText"></p>
</div>

<footer>
  © PDFGo • Files never leave your device
</footer>

<script src="https://unpkg.com/pdfjs-dist/build/pdf.min.js"></script>
<script src="https://unpkg.com/jszip/dist/jszip.min.js"></script>

<script>
  const dropZone = document.getElementById("drop-zone");
  const fileInput = document.getElementById("fileInput");
  const convertBtn = document.getElementById("convertBtn");
  const progress = document.getElementById("progress");
  const progressText = document.getElementById("progressText");

  let selectedFile = null;

  dropZone.onclick = () => fileInput.click();

  fileInput.onchange = () => {
    selectedFile = fileInput.files[0];
    convertBtn.disabled = !selectedFile;
  };

  dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.classList.add("dragover");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });

  dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    selectedFile = e.dataTransfer.files[0];
    convertBtn.disabled = !selectedFile;
  });

  convertBtn.onclick = () => convertPDF(selectedFile);

  async function convertPDF(file) {
    convertBtn.disabled = true;
    progress.value = 0;

    const buffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

    let start = Math.max(1, parseInt(startPage.value || 1));
    let end = Math.min(pdf.numPages, parseInt(endPage.value || pdf.numPages));
    if (start > end) [start, end] = [end, start];

    const total = end - start + 1;
    const zip = new JSZip();

    for (let i = start; i <= end; i++) {
      progressText.textContent = `กำลังแปลงหน้า ${i}/${end}`;
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({ scale: 2 });

      const canvas = document.createElement("canvas");
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({
        canvasContext: canvas.getContext("2d"),
        viewport
      }).promise;

      const blob = await new Promise(res => canvas.toBlob(res, "image/png"));
      zip.file(`page-${i}.png`, blob);

      progress.value = Math.round(((i - start + 1) / total) * 100);
    }

    progressText.textContent = "กำลังสร้าง ZIP...";
    const zipBlob = await zip.generateAsync({ type: "blob" });

    download(zipBlob, `pdf-${start}-to-${end}.zip`);

    progressText.textContent = "เสร็จเรียบร้อย ✅";
    convertBtn.disabled = false;
  }

  function download(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
